<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Hulme History</title>

    <link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
    <link href="stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="javascripts/all.js" type="text/javascript"></script>
  </head>

  <body class="index">
    <nav id='menu-ui' class='menu-ui'></nav>

<section id='timeline-section'>
  <div id='timeline'>
    <div id='tl-content'>
      <div id='crossbar'> </div>
      <ol class="decades">
          <li class="decade" value="1750">
            <time class="decade">1750</time>
          </li>
          <li class="decade" value="1760">
            <time class="decade">1760</time>
              <ol class="events">
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1761-bridgewater-canal-connected"
                    value="1761">Bridgewater Canal reached Castlefield</li>
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1761-industrial-revolution"
                    value="1761">Industrial Revolution</li>
              </ol>
          </li>
          <li class="decade" value="1770">
            <time class="decade">1770</time>
          </li>
          <li class="decade" value="1780">
            <time class="decade">1780</time>
          </li>
          <li class="decade" value="1790">
            <time class="decade">1790</time>
          </li>
          <li class="decade" value="1800">
            <time class="decade">1800</time>
          </li>
          <li class="decade" value="1810">
            <time class="decade">1810</time>
          </li>
          <li class="decade" value="1820">
            <time class="decade">1820</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat="53.4721"
                    lng="-2.2593"
                    data="1826-church-st-george"
                    value="1826">Church of St George</li>
              </ol>
          </li>
          <li class="decade" value="1830">
            <time class="decade">1830</time>
          </li>
          <li class="decade" value="1840">
            <time class="decade">1840</time>
              <ol class="events">
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1840-industrial-city"
                    value="1840">Industrial City</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1845-hulme-hall"
                    value="1845">Hulme Hall</li>
              </ol>
          </li>
          <li class="decade" value="1850">
            <time class="decade">1850</time>
          </li>
          <li class="decade" value="1860">
            <time class="decade">1860</time>
          </li>
          <li class="decade" value="1870">
            <time class="decade">1870</time>
          </li>
          <li class="decade" value="1880">
            <time class="decade">1880</time>
              <ol class="events">
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1884-rolls-royce"
                    value="1884">Rolls Royce factory</li>
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1885-shipping-canal-act-passed"
                    value="1885">Shipping Canal Act passed</li>
              </ol>
          </li>
          <li class="decade" value="1890">
            <time class="decade">1890</time>
          </li>
          <li class="decade" value="1900">
            <time class="decade">1900</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat="53.4643"
                    lng="-2.2494"
                    data="1901-hulme-hippodrome"
                    value="1901">Playhouse Theatre</li>
                <li class="event item block buildings"
                    lat="53.4536965"
                    lng="-2.7303314"
                    data="1905-hulme-hippodrome-2"
                    value="1901">Hulme Hippodrome</li>
              </ol>
          </li>
          <li class="decade" value="1910">
            <time class="decade">1910</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat="53.4666428"
                    lng="-2.2523659"
                    data="1911-zion-centre"
                    value="1911">Zion Centre/Chapel rebuild</li>
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1914-first-world-war"
                    value="1914">World War I</li>
              </ol>
          </li>
          <li class="decade" value="1920">
            <time class="decade">1920</time>
              <ol class="events">
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1920-poc-immigrant-communities"
                    value="1920">PoC immigrant communities</li>
              </ol>
          </li>
          <li class="decade" value="1930">
            <time class="decade">1930</time>
              <ol class="events">
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1939-second-world-war"
                    value="1939">World War II</li>
              </ol>
          </li>
          <li class="decade" value="1940">
            <time class="decade">1940</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1940-redbricks-bentley"
                    value="1940">Red Bricks/Bentley House</li>
              </ol>
          </li>
          <li class="decade" value="1950">
            <time class="decade">1950</time>
          </li>
          <li class="decade" value="1960">
            <time class="decade">1960</time>
              <ol class="events">
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="1960-slum-clearances"
                    value="1960">"Slum" clearances</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1961-the-mancunian-way"
                    value="1961">Mancunian way</li>
              </ol>
          </li>
          <li class="decade" value="1970">
            <time class="decade">1970</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1974-crescents-built"
                    value="1974">Crescents Built</li>
              </ol>
          </li>
          <li class="decade" value="1980">
            <time class="decade">1980</time>
              <ol class="events">
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1980-madchester"
                    value="1980">Madchester</li>
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1986-viraj-mendis"
                    value="1986">Viraj Mendis/Church of the ascension</li>
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1988-russell-club"
                    value="1988">PSV Club/Russell Club</li>
              </ol>
          </li>
          <li class="decade" value="1990">
            <time class="decade">1990</time>
              <ol class="events">
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1990-crescent-culture"
                    value="1990">Crescents Culture</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1992-health-and-hulme-report"
                    value="1992">Health and Hulme Report</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1992-hulme-city-challenge"
                    value="1992">Hulme City Challenge</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1993-yellowbricks"
                    value="1993">Work For Change</li>
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="1994-new-hulme"
                    value="1994">New Hulme?</li>
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="1999-garden-centre"
                    value="1999">Garden Centre</li>
              </ol>
          </li>
          <li class="decade" value="2000">
            <time class="decade">2000</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="2000-hulme-park"
                    value="2000">Hulme Park</li>
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="2000-red-bricks-cinema"
                    value="2000">Red Bricks Cinema</li>
                <li class="event item block news"
                    lat=""
                    lng=""
                    data="2002-commonwealth-games"
                    value="2002">Commonwealth Games</li>
                <li class="event item block community"
                    lat=""
                    lng=""
                    data="2005-crucifix-for-a-tree"
                    value="2005">Crucifix for a tree</li>
              </ol>
          </li>
          <li class="decade" value="2010">
            <time class="decade">2010</time>
              <ol class="events">
                <li class="event item block buildings"
                    lat=""
                    lng=""
                    data="2014-birley-fields-campus"
                    value="2014">Birley Fields Campus</li>
              </ol>
          </li>
      </ol>
    </div>
  </div>
  <div id='listholder'>
    <ol class="button-group">
    </ol>
  </div>
</section>

<section id='map'></section>

<script>
// SET PANNING RANGE HERE
var northeast = L.latLng(53.495634,-2.32168);
var southwest = L.latLng(53.455451,-2.223401);

if(southwest && northeast) {
  bounds = L.latLngBounds(southwest, northeast);
} else {
  bounds = null;
}

L.mapbox.accessToken = 'pk.eyJ1Ijoia2ltYWRhY3R5bCIsImEiOiJCYzdNTTR3In0.hkjyGpEFYdSPrVp3e717eA';
var map = L.map('map', {
  center: [53.468,-2.260],
  minZoom: 15,
  zoom:15,
  maxZoon: 19,
  maxBounds: bounds
});

  // { maxBounds: bounds,
  //   maxZoom:19,
  //   minZoom:11
  // });
var layers = document.getElementById('menu-ui');

// Colour defs
var buildings = "#7FBB71";
var blocks = "#CDCCCC";

// Base map
addLayer(L.mapbox.tileLayer('mapbox.light'), 'Base Map', 1);

// 1871 map layers
var group1871 = L.layerGroup();
addLayer(group1871, '1871', 2);
// Async load so that the styles work properly for now.
// Later we can edit the style info in the geojson directly.
$.getJSON('./gis/1871_figure_ground.geojson', function(data) {
  l = L.mapbox.featureLayer(data);
  l.addTo(group1871);
  l.setStyle({fillColor: buildings});
});

$.getJSON('./gis/1871_blocks.geojson', function(data) {
  l = L.mapbox.featureLayer(data);
  l.addTo(group1871);
  l.setStyle({fillColor: blocks});
});


// 1990 map layers
var group1990 = L.layerGroup();
//addLayer(group1990, '1990', 3);

$.getJSON('./gis/1990_figure_ground.geojson', function(data) {
  l = L.mapbox.featureLayer(data);
  l.addTo(group1990);
  l.setStyle({fillColor: buildings});
});

$.getJSON('./gis/1990_blocks.geojson', function(data) {
  l = L.mapbox.featureLayer(data);
  l.addTo(group1990);
  l.setStyle({fillColor: blocks});
});

// 2015 layers
var group2015 = L.layerGroup();
//addLayer(group2015, '2015', 4);

$.getJSON('./gis/2015_blocks.geojson', function(data) {
  l = L.mapbox.featureLayer(data);
  l.addTo(group2015);
  l.setStyle({fillColor: blocks});
});

//
map.present = group1871;
map.update = function() {
  current_year = parseInt($(".event.active").attr('value'));

  // Pick the appropriate map
  if(current_year < 1970){
    new_map = group1871;
  } else if(current_year < 1994) {
    new_map = group1990;
  } else {
    new_map = group2015;
  }

  // Do we need to change it?
  if(new_map != map.present){
    // map.present
    //     .getLayers()
    //     .forEach(function(l){
    //       // mess around with fading layer and then removing asynchronously.
    //       l.setStyle({'opacity':0});
    //     })
    if(map.hasLayer(map.present)){
      map.removeLayer(map.present);
    }

    // Perhaps similarly mess with fade in. If fade out and in async, should dissolve.
    map.present = new_map;
    map.addLayer(new_map);
  }
}

function addLayer(layer, name, zIndex) {
  layer
  .setZIndex(zIndex)
  .addTo(map);

  // Create a simple layer switcher that
  // toggles layers on and off.
  var link = document.createElement('a');
  link.href = '#';
  link.className = 'active';
  link.innerHTML = name;

  link.onclick = function(e) {
    e.preventDefault();
    e.stopPropagation();

    if (map.hasLayer(layer)) {
      map.removeLayer(layer);
      this.className = '';
    } else {
      map.addLayer(layer);
      this.className = 'active';
    }
  };

  layers.appendChild(link);
}
$('#timeline').mousedown(timeline_mousedown);

$('#tl-content').scroll(timeline_scroll)

$("li.event.item").each(function(){
  this.activate = function(){
    attrs = this.attributes;
    lat = attrs['lat'].value;
    lng = attrs['lng'].value;
    $(this).addClass("active");
    if (lat && lat != "") {
      var latlng = new L.latLng(parseFloat(lat),
                        parseFloat(lng))
      this.popup = popup_text(this.getAttribute('data'),latlng)
      map.panTo(latlng);
    }
    var midline = this.offsetTop + this.offsetHeight/2 - $("#crossbar").height();

    // // Sticky mode crossbar See timeline.js selecta() for smooth mode crossbar.
    // $("#crossbar").stop()
    //               .animate({top:midline, duration: 'fast'});
  }
  this.deactivate = function(){
    $(this).removeClass("active");
    // TODO: Eliminate auld popups!
    if(this.popup) {
      this.popup._close(); // Bad using private functions. Leaflet doesn't provide a cleanup function!
    }
  }
});


$("li.event").click(function(){
  // fixme: maths is wrong.
  var scroll = s_p_inv(this.offsetTop);
  $("#tl-content").animate({scrollTop:scroll});
})
</script>

  </body>
</html>
